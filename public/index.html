<!DOCTYPE html>
<!--indextest.html added the info button and recent games list-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="./assets/images/icons/swf.png" />
  <link rel="apple-touch-icon" href="./assets/images/icons/swf.png" />
  <link rel="icon" type="image/png" href="./assets/images/icons/swf.png" />
  <link rel="x-icon" type="image/png" href="./assets/images/icons/swf.png" />
  <title>Selector</title>
  <link rel="stylesheet" type="text/css" href="./assets/css/selector.css" />
</head>
<body>
  <form id="pageForm" autocomplete="off">
    <input list="pages" id="pageInput" placeholder="Choose a gameâ€¦" required />
    <datalist id="pages"></datalist>
    <button type="submit">Play!</button>
  </form>

  <div id="recentGames">
    <h3>Recent Games (Latest First)</h3>
    <ol id="recentList"></ol>
  </div>

  <div id="infoBtn">i</div>
<script>
  /* ---------- CONFIG ---------- */
  const maxRecent = 15;          // how many recent games to remember
  const optionsURL = "/assets/games.html";  // where the option list lives

  /* ---------- RECENT GAMES ---------- */
  function loadRecentGames() {
    const recent = JSON.parse(localStorage.getItem("recentGames") || "[]");
    const recentList = document.getElementById("recentList");
    if (!recentList) return;     // skip if page has no recent list container

    recentList.innerHTML = "";
    recent.forEach(name => {
      const li = document.createElement("li");
      li.textContent = name;
      li.style.cursor = "pointer";
      li.addEventListener("click", () => {
        const option = Array.from(
          document.querySelectorAll("#pages option")
        ).find(o => o.value.toLowerCase() === name.toLowerCase());

        if (option) window.location.href = option.dataset.url;
        else alert("Game not found.");
      });
      recentList.appendChild(li);
    });
  }

  /* ---------- MAIN BOOTSTRAP ---------- */
  window.addEventListener("DOMContentLoaded", () => {
    const datalist = document.getElementById("pages");
    const input    = document.getElementById("pageInput");

    /* 1. Fetch external option list */
    fetch(optionsURL)
      .then(res => {
        if (!res.ok) throw new Error(`Failed to load ${optionsURL}`);
        return res.text();
      })
      .then(html => {
        datalist.innerHTML = html;

        /* 2. Sort options alphabetically */
        const opts = Array.from(datalist.querySelectorAll("option"));
        opts.sort((a, b) =>
          a.value.toLowerCase().localeCompare(b.value.toLowerCase())
        );
        datalist.innerHTML = "";
        opts.forEach(o => datalist.appendChild(o));

        /* 3. Populate recent game list once options are ready */
        loadRecentGames();
      })
      .catch(err => {
        console.error(err);
        alert("Failed to load game list.");
        loadRecentGames(); // still try to show recents
      });

    /* 4. Form submission handling */
    document.getElementById("pageForm").addEventListener("submit", e => {
      e.preventDefault();
      const typed   = input.value.trim().toLowerCase();
      const options = document.querySelectorAll("#pages option");

      for (const o of options) {
        if (o.value.toLowerCase() === typed) {
          // Maintain recent-games list
          let recent = JSON.parse(localStorage.getItem("recentGames") || "[]");
          recent = recent.filter(v => v.toLowerCase() !== typed);
          recent.unshift(o.value);            // preserve original casing
          if (recent.length > maxRecent) recent.length = maxRecent;
          localStorage.setItem("recentGames", JSON.stringify(recent));

          loadRecentGames();                 // update list before navigation
          window.location.href = o.dataset.url;
          return;
        }
      }
      alert("Please select a valid page from the list.");
    });

    /* 5. Auto-open dropdown on focus */
    input.addEventListener("focus", () => {
      input.dispatchEvent(new KeyboardEvent("keydown", { key: "ArrowDown" }));
    });
  });
</script>
</body>
</html>
